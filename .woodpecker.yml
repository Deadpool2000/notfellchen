---

steps:
  create_docker_image:
    image: woodpeckerci/plugin-docker-buildx
    settings:
      repo: moanos/sphinx-rtd
      dockerfile: docs/Dockerfile
      tag: latest
      username:
        from_secret: docker_username
      password:
        from_secret: docker_password

  build:
    image: moanos/sphinx-rtd
    commands:
      - cd docs && make html

  deploy:
    image: appleboy/drone-scp
    settings:
      strip_components: 3
      host:
        from_secret: host
      username:
        from_secret: ssh_user
      target:
        from_secret: path
      source: docs/_build/html/
      key:
        from_secret: ssh_key



