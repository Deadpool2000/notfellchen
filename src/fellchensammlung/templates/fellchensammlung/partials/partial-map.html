{% load static %}
{% load custom_tags %}

<!-- add MapLibre JavaScript and CSS -->
<script src="https://tiles.versatiles.org/assets/maplibre-gl/maplibre-gl.js"></script>
<link href="https://tiles.versatiles.org/assets/maplibre-gl/maplibre-gl.css" rel="stylesheet"/>

<!-- add container for the map -->
<div id="map" style="width:100%;aspect-ratio:16/9"></div>

<!-- start map -->
<script>
    let map = new maplibregl.Map({
        container: 'map',
        style: 'https://tiles.versatiles.org/assets/styles/colorful.json',
        center: [10.49, 50.68],
        zoom: 5
    }).addControl(new maplibregl.NavigationControl());

    {% for an in adoption_notices %}
        // create the popup
        const popup_{{ forloop.counter }} = new maplibregl.Popup({offset: 25}).setText(
            '{{ an.name }}'
        );

        // create DOM element for the marker
        const el_{{ forloop.counter }} = document.createElement('div');
        el_{{ forloop.counter }}.id = 'marker_{{ forloop.counter }}';
        el_{{ forloop.counter }}.classList.add('marker');

        const location_popup_{{ forloop.counter }} = [{{ an.location.longitude | pointdecimal }}, {{ an.location.latitude | pointdecimal }}];
        // create the marker
        new maplibregl.Marker({element: el_{{ forloop.counter }}})
            .setLngLat(location_popup_{{ forloop.counter }})
            .setPopup(popup_{{ forloop.counter }}) // sets a popup on this marker
            .addTo(map);
    {% endfor %}
</script>
